<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Example analysis - Woodman et al 2019 • eSDM</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Example analysis - Woodman et al 2019">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">eSDM</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/example-analysis.html">Example analysis - Woodman et al 2019</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/smwoodman/eSDM">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Example analysis - Woodman et al 2019</h1>
                        <h4 class="author">Samuel Woodman</h4>
            
            <h4 class="date">2019-12-03</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/smwoodman/eSDM/blob/master/vignettes/example-analysis.Rmd"><code>vignettes/example-analysis.Rmd</code></a></small>
      <div class="hidden name"><code>example-analysis.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(dplyr)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(eSDM)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(lwgeom)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(sf)</span>
<span id="cb1-5"><a href="#cb1-5"></a></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"eSDM_vignette_helper.R"</span>, <span class="dt">package =</span> <span class="st">"eSDM"</span>), <span class="dt">local =</span> <span class="ot">TRUE</span>, <span class="dt">echo =</span> <span class="ot">FALSE</span>)</span></code></pre></div>
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p><code>eSDM</code> allows users to create ensembles of predictions from species distribution models (SDMs), either using the <code>eSDM</code> GUI or manually in R using <code>eSDM</code> functions. This vignette demonstrates creating and evaluating ensembles using <code>eSDM</code> functions by manually performing the example analysis from Woodman <em>et al.</em> (2019). The example analysis explores differences between blue whale SDM predictions for the California Current Ecosystem (CCE) from Becker <em>et al.</em> (2016; i.e., Model_B), Hazen <em>et al.</em> (2017; i.e., Model_H), and Redfern <em>et al.</em> (2017; i.e., Model_R). It also creates and evaluates ensembles of the predictions, with associated uncertainty. See Woodman <em>et al.</em> (2019) for additional details, and in particular Table 1 for details about differences between the models.</p>
<p>In this vignette, the three sets of predictions and the validation data are read from .rds files because the original files were too large to be included in the package. The sections where these data are imported includes the code for reading the data from their original files, although this code has been commented out. The original files can be downloaded through the GUI or at <a href="https://github.com/smwoodman/eSDM-data" class="uri">https://github.com/smwoodman/eSDM-data</a>.</p>
<p>This document contains code for plotting predictions. However, by default some of the plotting code is not run because it can take several minutes (these code chunks contain the comment “code not run”). If desired, you may run these code chunks manually in R.</p>
<p>Before using data from this example analysis, please see the README.txt file for proper citation information (located at <code>system.file("extdata/README.txt", package = "eSDM"</code>) and contact the author.</p>
</div>
<div id="import-sdm-predictions" class="section level2">
<h2 class="hasAnchor">
<a href="#import-sdm-predictions" class="anchor"></a>Import SDM predictions</h2>
<p>The first step of the example analysis is to import and process the Model_B, Model_H, and Model_R predictions, along with their standard error (SE) values. Use <code>pts2poly_centroids</code> to create <code>sf</code> objects from polygon centroids from CSV files, <code><a href="https://rdrr.io/pkg/raster/man/raster.html">raster::raster</a></code> to import raster files, and <code><a href="https://rdrr.io/pkg/sf/man/st_read.html">sf::st_read</a></code> to import GIS files. The dimensions of the Model_B and Model_H predictions are 0.09 x 0.09 degrees and 0.25 x 0.25 degrees, respectively; the second argument of <code>pts2poly_centroids</code> is half the length of one side of the polygon. GIS files already have a defined geometry that is read by <code>st_read</code>. Before overlaying predictions, you must ensure the following:</p>
<ul>
<li>All predictions are <code>sf</code> objects. See below for examples of converting a CSV file of grid centroids or a <code>raster</code> object to an <code>sf</code> object.</li>
<li>The geometries of the predictions are valid; this can be checked using <code><a href="https://rdrr.io/pkg/sf/man/geos_query.html">sf::st_is_valid</a></code>.</li>
<li>The geometries of the predictions have a defined coordinate reference system (crs); this can be checked using <code><a href="https://rdrr.io/pkg/sf/man/st_crs.html">sf::st_crs</a></code>.</li>
<li>The predictions have the same longitudinal range (i.e., either [0, 360] or [-180, 180]); this can be checked using <code><a href="https://rdrr.io/pkg/sf/man/st_bbox.html">sf::st_bbox</a></code>. You can use <code><a href="https://rdrr.io/pkg/sf/man/st_transform.html">sf::st_wrap_dateline</a></code> to convert an <code>sf</code> object to the longitudinal range [-180, 180], but note that this will cause plots to span [-180, 180] as well.</li>
</ul>
<p>We can visualize the SDM predictions after importing and processing them. The plots below make up Fig. 3 in Woodman <em>et al.</em> (2019). This vignette uses the custom <code>plot_sf_3panel</code> function (in ‘vignette_helper.R’ located at <code>system.file("vignette_helper.R", package = "eSDM"</code>) for plotting. <code>plot_sf_3panel</code> and <code>tmap_sdm</code> (used later in this vignette) were not included as functions in the <code>eSDM</code> package because they are specific to the example analysis region and SDMs. However, they can provide guidelines and a framework for plotting SDMs using the <code>sf</code> and <code>tmap</code> packages, allowing you to adapt these functions to your specific plotting needs.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># Import, process, and plot Model_B predictions</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="co"># model.b &lt;- read.csv("Predictions_Beckeretal2016.csv")</span></span>
<span id="cb2-3"><a href="#cb2-3"></a>model.b.sf &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata/Predictions_Beckeretal2016.rds"</span>, <span class="dt">package =</span> <span class="st">"eSDM"</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="st">  </span>eSDM<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/eSDM/man/pts2poly_centroids.html">pts2poly_centroids</a></span>(<span class="fl">0.09</span> <span class="op">/</span><span class="st"> </span><span class="dv">2</span>, <span class="dt">crs =</span> <span class="dv">4326</span>) <span class="op">%&gt;%</span></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="st">  </span><span class="kw">st_wrap_dateline</span>() <span class="op">%&gt;%</span></span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="st">  </span><span class="kw">st_set_agr</span>(<span class="st">"constant"</span>)</span>
<span id="cb2-7"><a href="#cb2-7"></a></span>
<span id="cb2-8"><a href="#cb2-8"></a>model.b.sf</span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="co">#&gt; Simple feature collection with 14807 features and 2 fields</span></span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="co">#&gt; Attribute-geometry relationship: 2 constant, 0 aggregate, 0 identity</span></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="co">#&gt; geometry type:  POLYGON</span></span>
<span id="cb2-12"><a href="#cb2-12"></a><span class="co">#&gt; dimension:      XY</span></span>
<span id="cb2-13"><a href="#cb2-13"></a><span class="co">#&gt; bbox:           xmin: -131.085 ymin: 30.045 xmax: -117.135 ymax: 48.585</span></span>
<span id="cb2-14"><a href="#cb2-14"></a><span class="co">#&gt; epsg (SRID):    4326</span></span>
<span id="cb2-15"><a href="#cb2-15"></a><span class="co">#&gt; proj4string:    +proj=longlat +datum=WGS84 +no_defs</span></span>
<span id="cb2-16"><a href="#cb2-16"></a><span class="co">#&gt; First 10 features:</span></span>
<span id="cb2-17"><a href="#cb2-17"></a><span class="co">#&gt;        pred_bm           se                       geometry</span></span>
<span id="cb2-18"><a href="#cb2-18"></a><span class="co">#&gt; 1  5.45105e-05 5.097233e-05 POLYGON ((-123.525 30.135, ...</span></span>
<span id="cb2-19"><a href="#cb2-19"></a><span class="co">#&gt; 2  5.24382e-05 5.361254e-05 POLYGON ((-123.435 30.135, ...</span></span>
<span id="cb2-20"><a href="#cb2-20"></a><span class="co">#&gt; 3  4.69742e-05 5.109131e-05 POLYGON ((-123.345 30.135, ...</span></span>
<span id="cb2-21"><a href="#cb2-21"></a><span class="co">#&gt; 4  4.23983e-05 4.816211e-05 POLYGON ((-123.255 30.135, ...</span></span>
<span id="cb2-22"><a href="#cb2-22"></a><span class="co">#&gt; 5  4.36095e-05 5.090475e-05 POLYGON ((-123.165 30.135, ...</span></span>
<span id="cb2-23"><a href="#cb2-23"></a><span class="co">#&gt; 6  1.07515e-04 8.646826e-05 POLYGON ((-123.705 30.225, ...</span></span>
<span id="cb2-24"><a href="#cb2-24"></a><span class="co">#&gt; 7  1.28310e-04 1.032217e-04 POLYGON ((-123.615 30.225, ...</span></span>
<span id="cb2-25"><a href="#cb2-25"></a><span class="co">#&gt; 8  1.18435e-04 1.022898e-04 POLYGON ((-123.525 30.225, ...</span></span>
<span id="cb2-26"><a href="#cb2-26"></a><span class="co">#&gt; 9  1.09491e-04 1.067405e-04 POLYGON ((-123.435 30.225, ...</span></span>
<span id="cb2-27"><a href="#cb2-27"></a><span class="co">#&gt; 10 1.07454e-04 1.186867e-04 POLYGON ((-123.345 30.225, ...</span></span>
<span id="cb2-28"><a href="#cb2-28"></a></span>
<span id="cb2-29"><a href="#cb2-29"></a><span class="co"># Make base map</span></span>
<span id="cb2-30"><a href="#cb2-30"></a>map.world &lt;-<span class="st"> </span>eSDM<span class="op">::</span>gshhg.l.L16</span>
<span id="cb2-31"><a href="#cb2-31"></a></span>
<span id="cb2-32"><a href="#cb2-32"></a><span class="co"># Other option for making base map</span></span>
<span id="cb2-33"><a href="#cb2-33"></a><span class="co"># map.world &lt;- st_geometry(st_as_sf(maps::map('world', plot = FALSE, fill = TRUE)))</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw">plot_sf_3panel</span>(</span>
<span id="cb3-2"><a href="#cb3-2"></a>  model.b.sf, <span class="st">"pred_bm"</span>, <span class="dt">main.txt =</span> <span class="st">"Model_B - "</span>, <span class="dt">map.base =</span> map.world, </span>
<span id="cb3-3"><a href="#cb3-3"></a>  <span class="dt">x.axis.at =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="dv">130</span>, <span class="dv">-125</span>, <span class="dv">-120</span>)</span>
<span id="cb3-4"><a href="#cb3-4"></a>)</span></code></pre></div>
<p><img src="example-analysis_files/figure-html/unnamed-chunk-3-1.png" width="672"></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># Import, process, and plot Model_H predictions</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="co"># model.h &lt;- read.csv("Predictions_Hazenetal2017.csv")</span></span>
<span id="cb4-3"><a href="#cb4-3"></a>model.h.sf &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata/Predictions_Hazenetal2017.rds"</span>, <span class="dt">package =</span> <span class="st">"eSDM"</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(lon, lat, pred_bm, se) <span class="op">%&gt;%</span></span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="st">  </span>eSDM<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/eSDM/man/pts2poly_centroids.html">pts2poly_centroids</a></span>(<span class="fl">0.25</span> <span class="op">/</span><span class="st"> </span><span class="dv">2</span>, <span class="dt">crs =</span> <span class="dv">4326</span>, <span class="dt">agr =</span> <span class="st">"constant"</span>)</span>
<span id="cb4-6"><a href="#cb4-6"></a></span>
<span id="cb4-7"><a href="#cb4-7"></a>model.h.sf</span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="co">#&gt; Simple feature collection with 4052 features and 2 fields</span></span>
<span id="cb4-9"><a href="#cb4-9"></a><span class="co">#&gt; Attribute-geometry relationship: 2 constant, 0 aggregate, 0 identity</span></span>
<span id="cb4-10"><a href="#cb4-10"></a><span class="co">#&gt; geometry type:  POLYGON</span></span>
<span id="cb4-11"><a href="#cb4-11"></a><span class="co">#&gt; dimension:      XY</span></span>
<span id="cb4-12"><a href="#cb4-12"></a><span class="co">#&gt; bbox:           xmin: -135.125 ymin: 29.875 xmax: -115.875 ymax: 49.125</span></span>
<span id="cb4-13"><a href="#cb4-13"></a><span class="co">#&gt; epsg (SRID):    4326</span></span>
<span id="cb4-14"><a href="#cb4-14"></a><span class="co">#&gt; proj4string:    +proj=longlat +datum=WGS84 +no_defs</span></span>
<span id="cb4-15"><a href="#cb4-15"></a><span class="co">#&gt; First 10 features:</span></span>
<span id="cb4-16"><a href="#cb4-16"></a><span class="co">#&gt;       pred_bm          se                       geometry</span></span>
<span id="cb4-17"><a href="#cb4-17"></a><span class="co">#&gt; 1  0.04554697 0.053372075 POLYGON ((-134.875 30.125, ...</span></span>
<span id="cb4-18"><a href="#cb4-18"></a><span class="co">#&gt; 2  0.03947545 0.033144082 POLYGON ((-134.625 30.125, ...</span></span>
<span id="cb4-19"><a href="#cb4-19"></a><span class="co">#&gt; 3  0.05845509 0.034460358 POLYGON ((-134.375 30.125, ...</span></span>
<span id="cb4-20"><a href="#cb4-20"></a><span class="co">#&gt; 4  0.05839801 0.036792245 POLYGON ((-134.125 30.125, ...</span></span>
<span id="cb4-21"><a href="#cb4-21"></a><span class="co">#&gt; 5  0.07102714 0.041752473 POLYGON ((-133.875 30.125, ...</span></span>
<span id="cb4-22"><a href="#cb4-22"></a><span class="co">#&gt; 6  0.04468036 0.018479887 POLYGON ((-133.625 30.125, ...</span></span>
<span id="cb4-23"><a href="#cb4-23"></a><span class="co">#&gt; 7  0.05754484 0.009460079 POLYGON ((-133.375 30.125, ...</span></span>
<span id="cb4-24"><a href="#cb4-24"></a><span class="co">#&gt; 8  0.03529852 0.017022402 POLYGON ((-133.125 30.125, ...</span></span>
<span id="cb4-25"><a href="#cb4-25"></a><span class="co">#&gt; 9  0.10666410 0.063944752 POLYGON ((-132.875 30.125, ...</span></span>
<span id="cb4-26"><a href="#cb4-26"></a><span class="co">#&gt; 10 0.11393473 0.061255526 POLYGON ((-132.625 30.125, ...</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw">plot_sf_3panel</span>(</span>
<span id="cb5-2"><a href="#cb5-2"></a>  model.h.sf, <span class="st">"pred_bm"</span>, <span class="dt">main.txt =</span> <span class="st">"Model_H - "</span>, <span class="dt">map.base =</span> map.world, </span>
<span id="cb5-3"><a href="#cb5-3"></a>  <span class="dt">x.axis.at =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="dv">135</span>, <span class="dv">-130</span>, <span class="dv">-125</span>, <span class="dv">-120</span>)</span>
<span id="cb5-4"><a href="#cb5-4"></a>)</span></code></pre></div>
<p><img src="example-analysis_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># Import, process, and plot Model_R predictions</span></span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="co"># model.r &lt;- st_read("Shapefiles/Predictions_Redfernetal2017.shp")</span></span>
<span id="cb6-3"><a href="#cb6-3"></a>model.r.sf &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata/Predictions_Redfernetal2017.rds"</span>, <span class="dt">package =</span> <span class="st">"eSDM"</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="st">  </span><span class="kw">st_make_valid</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="co">#</span></span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="st">  </span><span class="kw">st_set_agr</span>(<span class="st">"constant"</span>)</span>
<span id="cb6-6"><a href="#cb6-6"></a></span>
<span id="cb6-7"><a href="#cb6-7"></a>model.r.sf</span>
<span id="cb6-8"><a href="#cb6-8"></a><span class="co">#&gt; Simple feature collection with 11419 features and 2 fields</span></span>
<span id="cb6-9"><a href="#cb6-9"></a><span class="co">#&gt; Attribute-geometry relationship: 2 constant, 0 aggregate, 0 identity</span></span>
<span id="cb6-10"><a href="#cb6-10"></a><span class="co">#&gt; geometry type:  MULTIPOLYGON</span></span>
<span id="cb6-11"><a href="#cb6-11"></a><span class="co">#&gt; dimension:      XY</span></span>
<span id="cb6-12"><a href="#cb6-12"></a><span class="co">#&gt; bbox:           xmin: -14587510 ymin: 3176115 xmax: -13037510 ymax: 4766115</span></span>
<span id="cb6-13"><a href="#cb6-13"></a><span class="co">#&gt; epsg (SRID):    NA</span></span>
<span id="cb6-14"><a href="#cb6-14"></a><span class="co">#&gt; proj4string:    +proj=cea +lon_0=0 +lat_ts=0 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs</span></span>
<span id="cb6-15"><a href="#cb6-15"></a><span class="co">#&gt; First 10 features:</span></span>
<span id="cb6-16"><a href="#cb6-16"></a><span class="co">#&gt;        pred_bm           se                       geometry</span></span>
<span id="cb6-17"><a href="#cb6-17"></a><span class="co">#&gt; 1  0.008025090 0.0064684470 MULTIPOLYGON (((-13037935 3...</span></span>
<span id="cb6-18"><a href="#cb6-18"></a><span class="co">#&gt; 2  0.009190831 0.0074858911 MULTIPOLYGON (((-13047508 3...</span></span>
<span id="cb6-19"><a href="#cb6-19"></a><span class="co">#&gt; 3  0.007789538 0.0063127310 MULTIPOLYGON (((-13046258 3...</span></span>
<span id="cb6-20"><a href="#cb6-20"></a><span class="co">#&gt; 4  0.004794084 0.0007867314 MULTIPOLYGON (((-13197508 3...</span></span>
<span id="cb6-21"><a href="#cb6-21"></a><span class="co">#&gt; 5  0.004978912 0.0015665607 MULTIPOLYGON (((-13177508 3...</span></span>
<span id="cb6-22"><a href="#cb6-22"></a><span class="co">#&gt; 6  0.004869921 0.0008426572 MULTIPOLYGON (((-13197508 3...</span></span>
<span id="cb6-23"><a href="#cb6-23"></a><span class="co">#&gt; 7  0.004953553 0.0012025559 MULTIPOLYGON (((-13196624 3...</span></span>
<span id="cb6-24"><a href="#cb6-24"></a><span class="co">#&gt; 8  0.004699313 0.0014451453 MULTIPOLYGON (((-13177508 3...</span></span>
<span id="cb6-25"><a href="#cb6-25"></a><span class="co">#&gt; 9  0.004930461 0.0011039563 MULTIPOLYGON (((-13197508 3...</span></span>
<span id="cb6-26"><a href="#cb6-26"></a><span class="co">#&gt; 10          NA           NA MULTIPOLYGON (((-13067508 3...</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw">plot_sf_3panel</span>(</span>
<span id="cb7-2"><a href="#cb7-2"></a>  model.r.sf, <span class="st">"pred_bm"</span>, <span class="dt">main.txt =</span> <span class="st">"Model_R - "</span>, <span class="dt">map.base =</span> map.world, </span>
<span id="cb7-3"><a href="#cb7-3"></a>  <span class="dt">x.axis.at =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="dv">130</span>, <span class="dv">-125</span>, <span class="dv">-120</span>)</span>
<span id="cb7-4"><a href="#cb7-4"></a>)</span></code></pre></div>
<p><img src="example-analysis_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># Example code for converting raster to sf object; code not run</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>logo &lt;-<span class="st"> </span>raster<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/raster/man/raster.html">raster</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"external/rlogo.grd"</span>, <span class="dt">package=</span><span class="st">"raster"</span>))</span>
<span id="cb8-3"><a href="#cb8-3"></a>logo.sf &lt;-<span class="st"> </span><span class="kw">as</span>(logo, <span class="st">"SpatialPolygonsDataFrame"</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="st">  </span>sf<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/sf/man/st_as_sf.html">st_as_sf</a></span>()</span></code></pre></div>
</div>
<div id="overlay-predictions" class="section level2">
<h2 class="hasAnchor">
<a href="#overlay-predictions" class="anchor"></a>Overlay predictions</h2>
<p>Because the original predictions have both different spatial resolutions and coordinate systems, we must overlay them onto the same base geometry. See Woodman <em>et al.</em> (2019), the <code>eSDM</code> GUI manual, or the <code>overlay_sdm</code> documentation for details about the overlay process. For the example analysis, we use the geometry of Model_R as the base geometry. However, first we must import and process the study area and erasing polygons, with which we clip and erase land from the base geometry, respectively. We also visualize the base geometry.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># Study area polygon</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>poly.study &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata/Shapefiles/Study_Area_CCE.shp"</span>, <span class="dt">package =</span> <span class="st">"eSDM"</span>)) <span class="op">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="st">  </span><span class="kw">st_geometry</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="st">  </span><span class="kw">st_transform</span>(<span class="kw">st_crs</span>(model.r.sf))</span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="co">#&gt; Reading layer `Study_Area_CCE' from data source `C:\Users\sam.woodman\AppData\Local\Temp\Rtmpczj0KB\temp_libpath1d7466251f57\eSDM\extdata\Shapefiles\Study_Area_CCE.shp' using driver `ESRI Shapefile'</span></span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="co">#&gt; Simple feature collection with 1 feature and 6 fields</span></span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="co">#&gt; geometry type:  POLYGON</span></span>
<span id="cb9-8"><a href="#cb9-8"></a><span class="co">#&gt; dimension:      XY</span></span>
<span id="cb9-9"><a href="#cb9-9"></a><span class="co">#&gt; bbox:           xmin: -131 ymin: 30.05 xmax: -117.013 ymax: 48.6</span></span>
<span id="cb9-10"><a href="#cb9-10"></a><span class="co">#&gt; epsg (SRID):    4326</span></span>
<span id="cb9-11"><a href="#cb9-11"></a><span class="co">#&gt; proj4string:    +proj=longlat +datum=WGS84 +no_defs</span></span>
<span id="cb9-12"><a href="#cb9-12"></a></span>
<span id="cb9-13"><a href="#cb9-13"></a><span class="co"># Erasing polygon; clip to the buffered study area polygon reduces future computation time</span></span>
<span id="cb9-14"><a href="#cb9-14"></a>poly.erase &lt;-<span class="st"> </span>eSDM<span class="op">::</span>gshhg.l.L16 <span class="op">%&gt;%</span></span>
<span id="cb9-15"><a href="#cb9-15"></a><span class="st">  </span><span class="kw">st_transform</span>(<span class="kw">st_crs</span>(model.r.sf)) <span class="op">%&gt;%</span></span>
<span id="cb9-16"><a href="#cb9-16"></a><span class="st">  </span>lwgeom<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/lwgeom/man/valid.html">st_make_valid</a></span>() <span class="op">%&gt;%</span></span>
<span id="cb9-17"><a href="#cb9-17"></a><span class="st">  </span><span class="kw">st_crop</span>(<span class="kw">st_buffer</span>(poly.study, <span class="dv">100000</span>))</span>
<span id="cb9-18"><a href="#cb9-18"></a></span>
<span id="cb9-19"><a href="#cb9-19"></a><span class="co"># Create the base geometry; st_erase() function defined in eSDM_vignette_helper.R</span></span>
<span id="cb9-20"><a href="#cb9-20"></a>base.geom &lt;-<span class="st"> </span>model.r.sf <span class="op">%&gt;%</span></span>
<span id="cb9-21"><a href="#cb9-21"></a><span class="st">  </span><span class="kw">st_geometry</span>() <span class="op">%&gt;%</span></span>
<span id="cb9-22"><a href="#cb9-22"></a><span class="st">  </span><span class="kw">st_erase</span>(poly.erase) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb9-23"><a href="#cb9-23"></a><span class="st">  </span><span class="kw">st_intersection</span>(poly.study) <span class="op">%&gt;%</span></span>
<span id="cb9-24"><a href="#cb9-24"></a><span class="st">  </span><span class="kw">st_cast</span>(<span class="st">"MULTIPOLYGON"</span>)</span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># Visualize the base geometry</span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(<span class="kw">st_transform</span>(base.geom, <span class="dv">4326</span>), <span class="dt">col =</span> <span class="ot">NA</span>, <span class="dt">border =</span> <span class="st">"black"</span>, <span class="dt">axes =</span> <span class="ot">TRUE</span>)</span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(map.world, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">col =</span> <span class="st">"tan"</span>, <span class="dt">border =</span> <span class="ot">NA</span>)</span>
<span id="cb10-4"><a href="#cb10-4"></a>graphics<span class="op">::</span><span class="kw"><a href="https://rdrr.io/r/graphics/box.html">box</a></span>()</span></code></pre></div>
<p><img src="example-analysis_files/figure-html/unnamed-chunk-10-1.png" width="480"></p>
<p>Next, we convert any associated uncertainty values to variance. Uncertainty values must be overlaid as variance values to remain statistically valid.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># Convert SE values to variance</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>model.b.sf &lt;-<span class="st"> </span>model.b.sf <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">variance =</span> se<span class="op">^</span><span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(pred_bm, se, variance)</span>
<span id="cb11-5"><a href="#cb11-5"></a>model.h.sf &lt;-<span class="st"> </span>model.h.sf <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb11-6"><a href="#cb11-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">variance =</span> se<span class="op">^</span><span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(pred_bm, se, variance)</span>
<span id="cb11-8"><a href="#cb11-8"></a>model.r.sf &lt;-<span class="st"> </span>model.r.sf <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb11-9"><a href="#cb11-9"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">variance =</span> se<span class="op">^</span><span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb11-10"><a href="#cb11-10"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(pred_bm, se, variance)</span></code></pre></div>
<p>Now we can overlay the original predictions onto the base geometry. Note that because we clipped and erased land from the base geometry, we cannot simply use the original Model_R predictions and geometry. However, we can ‘overlay’ the Model_R predictions by matching indices of base geometry polygons and Model_R prediction values (<code>over3.sfb</code> in the code below).</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="co"># Perform overlay, and convert overlaid uncertainty values to SEs</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>over1.sf &lt;-<span class="st"> </span>eSDM<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/eSDM/man/overlay_sdm.html">overlay_sdm</a></span>(base.geom, <span class="kw">st_transform</span>(model.b.sf, <span class="kw">st_crs</span>(base.geom)), <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"pred_bm"</span>, <span class="st">"variance"</span>), <span class="dv">50</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb12-3"><a href="#cb12-3"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">se =</span> <span class="kw"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(variance))</span>
<span id="cb12-4"><a href="#cb12-4"></a>over2.sf &lt;-<span class="st"> </span>eSDM<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/eSDM/man/overlay_sdm.html">overlay_sdm</a></span>(base.geom, <span class="kw">st_transform</span>(model.h.sf, <span class="kw">st_crs</span>(base.geom)), <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"pred_bm"</span>, <span class="st">"variance"</span>), <span class="dv">50</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb12-5"><a href="#cb12-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">se =</span> <span class="kw"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(variance))</span>
<span id="cb12-6"><a href="#cb12-6"></a>over3.sf &lt;-<span class="st"> </span>eSDM<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/eSDM/man/overlay_sdm.html">overlay_sdm</a></span>(base.geom, model.r.sf, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"pred_bm"</span>, <span class="st">"variance"</span>), <span class="dv">50</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb12-7"><a href="#cb12-7"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">se =</span> <span class="kw"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(variance))</span>
<span id="cb12-8"><a href="#cb12-8"></a></span>
<span id="cb12-9"><a href="#cb12-9"></a>over3.sfb &lt;-<span class="st"> </span>model.r.sf <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb12-10"><a href="#cb12-10"></a><span class="st">  </span><span class="kw">st_set_geometry</span>(<span class="ot">NULL</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb12-11"><a href="#cb12-11"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(pred_bm, variance) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb12-12"><a href="#cb12-12"></a><span class="st">  </span><span class="kw">st_sf</span>(<span class="dt">geometry =</span> base.geom, <span class="dt">agr =</span> <span class="st">"constant"</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb12-13"><a href="#cb12-13"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">se =</span> <span class="kw"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(variance))</span>
<span id="cb12-14"><a href="#cb12-14"></a><span class="kw"><a href="https://rdrr.io/r/base/all.equal.html">all.equal</a></span>(over3.sf, over3.sfb)</span>
<span id="cb12-15"><a href="#cb12-15"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb12-16"><a href="#cb12-16"></a><span class="kw"><a href="https://rdrr.io/r/base/rm.html">rm</a></span>(over3.sfb)</span></code></pre></div>
<p>We also could plot the overlaid predictions to show that the overlaid distribution patterns are very similar to those of the original predictions.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># Plot overlaid predictions; code not run</span></span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="kw">plot_sf_3panel</span>(over1.sf, <span class="st">"pred_bm"</span>, <span class="dt">main.txt =</span> <span class="st">"Overlaid Model_B - "</span>, <span class="dt">map.base =</span> map.world)</span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="kw">plot_sf_3panel</span>(over2.sf, <span class="st">"pred_bm"</span>, <span class="dt">main.txt =</span> <span class="st">"Overlaid Model_H - "</span>, <span class="dt">map.base =</span> map.world)</span>
<span id="cb13-4"><a href="#cb13-4"></a><span class="kw">plot_sf_3panel</span>(over3.sf, <span class="st">"pred_bm"</span>, <span class="dt">main.txt =</span> <span class="st">"Overlaid Model_R - "</span>, <span class="dt">map.base =</span> map.world)</span></code></pre></div>
</div>
<div id="calculate-evaluation-metrics" class="section level2">
<h2 class="hasAnchor">
<a href="#calculate-evaluation-metrics" class="anchor"></a>Calculate evaluation metrics</h2>
<p>To evaluate predictions and create ensembles with weights based on evaluation metrics, we must load and process the validation data sets for use with <code>evaluation_metrics</code>. The validation data must be points of class <code>sf</code> with a column with either binary presence/absence or count data. For the example analysis, we use three validation sets in the example analysis, line transect data (Becker <em>et al.</em> 2016), home range data (Irvine <em>et al.</em> 2014), and these two data sets combined. Because our validation data are binary (i.e., presence/absence), there is a column indicating whether each value is a presence point (1) or absence point (0).</p>
<p>Note that in this vignette, the validation data are read from .rds files because the original file was too big to be included in the package. However, the original file can be downloaded through the GUI or at <a href="https://github.com/smwoodman/eSDM-data" class="uri">https://github.com/smwoodman/eSDM-data</a></p>
<p>Use the function <code><a href="https://rdrr.io/pkg/sf/man/st_as_sf.html">sf::st_as_sf</a></code> to convert a data frame with lon/lat coordinates to an <code>sf</code> object.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co"># Import and process validation data</span></span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="co"># valid.data &lt;- read.csv("eSDM_Validation_data_all.csv", stringsAsFactors = FALSE)</span></span>
<span id="cb14-3"><a href="#cb14-3"></a>valid.data &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata/eSDM_Validation_data_all.rds"</span>, <span class="dt">package =</span> <span class="st">"eSDM"</span>))<span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb14-4"><a href="#cb14-4"></a><span class="st">  </span><span class="kw">arrange</span>(source, lat, lon) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb14-5"><a href="#cb14-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pres_abs =</span> <span class="kw"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(pres_abs <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="co">#For demonstration purposes; pres_abs column is already binary</span></span>
<span id="cb14-6"><a href="#cb14-6"></a><span class="st">  </span><span class="kw">st_as_sf</span>(<span class="dt">coords =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"lon"</span>, <span class="st">"lat"</span>), <span class="dt">crs =</span> <span class="dv">4326</span>, <span class="dt">agr =</span> <span class="st">"constant"</span>) <span class="op">%&gt;%</span></span>
<span id="cb14-7"><a href="#cb14-7"></a><span class="st">  </span><span class="kw">st_transform</span>(<span class="kw">st_crs</span>(base.geom))</span>
<span id="cb14-8"><a href="#cb14-8"></a></span>
<span id="cb14-9"><a href="#cb14-9"></a><span class="co"># Extract the line transect and home range validation data</span></span>
<span id="cb14-10"><a href="#cb14-10"></a>valid.data.lt &lt;-<span class="st"> </span>valid.data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(source <span class="op">==</span><span class="st"> "Becker_et_al_2016"</span>)</span>
<span id="cb14-11"><a href="#cb14-11"></a>valid.data.hr &lt;-<span class="st"> </span>valid.data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(source <span class="op">==</span><span class="st"> "Irvine_et_al_2014"</span>)</span>
<span id="cb14-12"><a href="#cb14-12"></a></span>
<span id="cb14-13"><a href="#cb14-13"></a><span class="co"># Summarize the number of presence and absence points</span></span>
<span id="cb14-14"><a href="#cb14-14"></a>valid.data <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb14-15"><a href="#cb14-15"></a><span class="st">  </span><span class="kw">st_set_geometry</span>(<span class="ot">NULL</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb14-16"><a href="#cb14-16"></a><span class="st">  </span><span class="kw">group_by</span>(source) <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb14-17"><a href="#cb14-17"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">pres =</span> <span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(pres_abs <span class="op">==</span><span class="st"> </span><span class="dv">1</span>), </span>
<span id="cb14-18"><a href="#cb14-18"></a>            <span class="dt">abs =</span> <span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(pres_abs <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb14-19"><a href="#cb14-19"></a><span class="st">  </span>knitr<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(<span class="dt">caption =</span> <span class="st">"Validation data summary"</span>)</span></code></pre></div>
<table class="table">
<caption>Validation data summary</caption>
<thead><tr class="header">
<th align="left">source</th>
<th align="right">pres</th>
<th align="right">abs</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Becker_et_al_2016</td>
<td align="right">71</td>
<td align="right">7368</td>
</tr>
<tr class="even">
<td align="left">Irvine_et_al_2014</td>
<td align="right">328</td>
<td align="right">10386</td>
</tr>
</tbody>
</table>
<p>Now we can calculate the AUC and TSS metrics for the original and overlaid predictions. The displayed table is from Table 3 of Woodman <em>et al.</em> (2019). Note that <code>evaluation_metrics</code> requires that validation data have the same coordinate reference system as the predictions being evaluated.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># Calculate evaluation metrics with different validation data sets; code not run</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>names<span class="fl">.1</span> &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(</span>
<span id="cb15-3"><a href="#cb15-3"></a>  <span class="st">"Model_B_orig"</span>, <span class="st">"Model_H_orig"</span>, <span class="st">"Model_R_orig"</span>, </span>
<span id="cb15-4"><a href="#cb15-4"></a>  <span class="st">"Model_B_overlaid"</span>, <span class="st">"Model_H_overlaid"</span>, <span class="st">"Model_R_overlaid"</span></span>
<span id="cb15-5"><a href="#cb15-5"></a>)</span>
<span id="cb15-6"><a href="#cb15-6"></a></span>
<span id="cb15-7"><a href="#cb15-7"></a>eval.lt &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span>(rbind, <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</span>
<span id="cb15-8"><a href="#cb15-8"></a>  eSDM<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/eSDM/man/evaluation_metrics.html">evaluation_metrics</a></span>(model.b.sf, <span class="dv">1</span>, <span class="kw">st_transform</span>(valid.data.lt, <span class="dv">4326</span>), <span class="st">"pres_abs"</span>), </span>
<span id="cb15-9"><a href="#cb15-9"></a>  eSDM<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/eSDM/man/evaluation_metrics.html">evaluation_metrics</a></span>(model.h.sf, <span class="dv">1</span>, <span class="kw">st_transform</span>(valid.data.lt, <span class="dv">4326</span>), <span class="st">"pres_abs"</span>), </span>
<span id="cb15-10"><a href="#cb15-10"></a>  eSDM<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/eSDM/man/evaluation_metrics.html">evaluation_metrics</a></span>(model.r.sf, <span class="dv">1</span>, valid.data.lt, <span class="st">"pres_abs"</span>), </span>
<span id="cb15-11"><a href="#cb15-11"></a>  eSDM<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/eSDM/man/evaluation_metrics.html">evaluation_metrics</a></span>(over1.sf, <span class="dv">1</span>, valid.data.lt, <span class="st">"pres_abs"</span>), </span>
<span id="cb15-12"><a href="#cb15-12"></a>  eSDM<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/eSDM/man/evaluation_metrics.html">evaluation_metrics</a></span>(over2.sf, <span class="dv">1</span>, valid.data.lt, <span class="st">"pres_abs"</span>), </span>
<span id="cb15-13"><a href="#cb15-13"></a>  eSDM<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/eSDM/man/evaluation_metrics.html">evaluation_metrics</a></span>(over3.sf, <span class="dv">1</span>, valid.data.lt, <span class="st">"pres_abs"</span>)</span>
<span id="cb15-14"><a href="#cb15-14"></a>))) <span class="op">%&gt;%</span></span>
<span id="cb15-15"><a href="#cb15-15"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Preds =</span> names<span class="fl">.1</span>) <span class="op">%&gt;%</span></span>
<span id="cb15-16"><a href="#cb15-16"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(Preds, <span class="dt">AUC_LT =</span> X1, <span class="dt">TSS_LT =</span> X2)</span>
<span id="cb15-17"><a href="#cb15-17"></a></span>
<span id="cb15-18"><a href="#cb15-18"></a>eval.hr &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span>(rbind, <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</span>
<span id="cb15-19"><a href="#cb15-19"></a>  eSDM<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/eSDM/man/evaluation_metrics.html">evaluation_metrics</a></span>(model.b.sf, <span class="dv">1</span>, <span class="kw">st_transform</span>(valid.data.hr, <span class="dv">4326</span>), <span class="st">"pres_abs"</span>), </span>
<span id="cb15-20"><a href="#cb15-20"></a>  eSDM<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/eSDM/man/evaluation_metrics.html">evaluation_metrics</a></span>(model.h.sf, <span class="dv">1</span>, <span class="kw">st_transform</span>(valid.data.hr, <span class="dv">4326</span>), <span class="st">"pres_abs"</span>), </span>
<span id="cb15-21"><a href="#cb15-21"></a>  eSDM<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/eSDM/man/evaluation_metrics.html">evaluation_metrics</a></span>(model.r.sf, <span class="dv">1</span>, valid.data.hr, <span class="st">"pres_abs"</span>), </span>
<span id="cb15-22"><a href="#cb15-22"></a>  eSDM<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/eSDM/man/evaluation_metrics.html">evaluation_metrics</a></span>(over1.sf, <span class="dv">1</span>, valid.data.hr, <span class="st">"pres_abs"</span>), </span>
<span id="cb15-23"><a href="#cb15-23"></a>  eSDM<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/eSDM/man/evaluation_metrics.html">evaluation_metrics</a></span>(over2.sf, <span class="dv">1</span>, valid.data.hr, <span class="st">"pres_abs"</span>), </span>
<span id="cb15-24"><a href="#cb15-24"></a>  eSDM<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/eSDM/man/evaluation_metrics.html">evaluation_metrics</a></span>(over3.sf, <span class="dv">1</span>, valid.data.hr, <span class="st">"pres_abs"</span>)</span>
<span id="cb15-25"><a href="#cb15-25"></a>))) <span class="op">%&gt;%</span></span>
<span id="cb15-26"><a href="#cb15-26"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Preds =</span> names<span class="fl">.1</span>) <span class="op">%&gt;%</span></span>
<span id="cb15-27"><a href="#cb15-27"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(Preds, <span class="dt">AUC_HR =</span> X1, <span class="dt">TSS_HR =</span> X2)</span>
<span id="cb15-28"><a href="#cb15-28"></a></span>
<span id="cb15-29"><a href="#cb15-29"></a>eval.combo &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span>(rbind, <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</span>
<span id="cb15-30"><a href="#cb15-30"></a>  eSDM<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/eSDM/man/evaluation_metrics.html">evaluation_metrics</a></span>(model.b.sf, <span class="dv">1</span>, <span class="kw">st_transform</span>(valid.data, <span class="dv">4326</span>), <span class="st">"pres_abs"</span>), </span>
<span id="cb15-31"><a href="#cb15-31"></a>  eSDM<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/eSDM/man/evaluation_metrics.html">evaluation_metrics</a></span>(model.h.sf, <span class="dv">1</span>, <span class="kw">st_transform</span>(valid.data, <span class="dv">4326</span>), <span class="st">"pres_abs"</span>), </span>
<span id="cb15-32"><a href="#cb15-32"></a>  eSDM<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/eSDM/man/evaluation_metrics.html">evaluation_metrics</a></span>(model.r.sf, <span class="dv">1</span>, valid.data, <span class="st">"pres_abs"</span>), </span>
<span id="cb15-33"><a href="#cb15-33"></a>  eSDM<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/eSDM/man/evaluation_metrics.html">evaluation_metrics</a></span>(over1.sf, <span class="dv">1</span>, valid.data, <span class="st">"pres_abs"</span>), </span>
<span id="cb15-34"><a href="#cb15-34"></a>  eSDM<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/eSDM/man/evaluation_metrics.html">evaluation_metrics</a></span>(over2.sf, <span class="dv">1</span>, valid.data, <span class="st">"pres_abs"</span>), </span>
<span id="cb15-35"><a href="#cb15-35"></a>  eSDM<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/eSDM/man/evaluation_metrics.html">evaluation_metrics</a></span>(over3.sf, <span class="dv">1</span>, valid.data, <span class="st">"pres_abs"</span>)</span>
<span id="cb15-36"><a href="#cb15-36"></a>))) <span class="op">%&gt;%</span></span>
<span id="cb15-37"><a href="#cb15-37"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Preds =</span> names<span class="fl">.1</span>) <span class="op">%&gt;%</span></span>
<span id="cb15-38"><a href="#cb15-38"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(Preds, <span class="dt">AUC =</span> X1, <span class="dt">TSS =</span> X2)</span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="kw"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata/Table3.csv"</span>, <span class="dt">package =</span> <span class="st">"eSDM"</span>)) <span class="op">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2"></a><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"Model_"</span>, Predictions)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb16-3"><a href="#cb16-3"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(Predictions, AUC, TSS, <span class="st">`</span><span class="dt">AUC-LT</span><span class="st">`</span> =<span class="st"> </span>AUC.LT, <span class="st">`</span><span class="dt">TSS-LT</span><span class="st">`</span> =<span class="st"> </span>TSS.LT, </span>
<span id="cb16-4"><a href="#cb16-4"></a>                <span class="st">`</span><span class="dt">AUC-HR</span><span class="st">`</span> =<span class="st"> </span>AUC.HR, <span class="st">`</span><span class="dt">TSS-HR</span><span class="st">`</span> =<span class="st"> </span>TSS.HR) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb16-5"><a href="#cb16-5"></a><span class="st">  </span>knitr<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(<span class="dt">caption =</span> <span class="st">"Evaluation metrics"</span>, <span class="dt">digits =</span> <span class="dv">3</span>, <span class="dt">align =</span> <span class="st">"lcccccc"</span>)</span></code></pre></div>
<table class="table">
<caption>Evaluation metrics</caption>
<thead><tr class="header">
<th align="left">Predictions</th>
<th align="center">AUC</th>
<th align="center">TSS</th>
<th align="center">AUC-LT</th>
<th align="center">TSS-LT</th>
<th align="center">AUC-HR</th>
<th align="center">TSS-HR</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Model_B - original</td>
<td align="center">0.912</td>
<td align="center">0.717</td>
<td align="center">0.732</td>
<td align="center">0.374</td>
<td align="center">0.963</td>
<td align="center">0.824</td>
</tr>
<tr class="even">
<td align="left">Model_H - original</td>
<td align="center">0.734</td>
<td align="center">0.414</td>
<td align="center">0.620</td>
<td align="center">0.284</td>
<td align="center">0.772</td>
<td align="center">0.471</td>
</tr>
<tr class="odd">
<td align="left">Model_R - original</td>
<td align="center">0.919</td>
<td align="center">0.756</td>
<td align="center">0.684</td>
<td align="center">0.290</td>
<td align="center">0.980</td>
<td align="center">0.882</td>
</tr>
<tr class="even">
<td align="left">Model_B - overlaid</td>
<td align="center">0.916</td>
<td align="center">0.742</td>
<td align="center">0.732</td>
<td align="center">0.380</td>
<td align="center">0.967</td>
<td align="center">0.856</td>
</tr>
<tr class="odd">
<td align="left">Model_H - overlaid</td>
<td align="center">0.735</td>
<td align="center">0.406</td>
<td align="center">0.620</td>
<td align="center">0.286</td>
<td align="center">0.772</td>
<td align="center">0.460</td>
</tr>
<tr class="even">
<td align="left">Model_R - overlaid</td>
<td align="center">0.919</td>
<td align="center">0.756</td>
<td align="center">0.684</td>
<td align="center">0.290</td>
<td align="center">0.980</td>
<td align="center">0.882</td>
</tr>
</tbody>
</table>
<p>We can see that for each set of predictions, the original and overlaid evaluation metrics are quite similar, again showing that the overlay conserved the predicted blue whale distributions.</p>
</div>
<div id="create-and-evaluate-ensemble-predictions" class="section level2">
<h2 class="hasAnchor">
<a href="#create-and-evaluate-ensemble-predictions" class="anchor"></a>Create and evaluate ensemble predictions</h2>
<p>Before creating the ensembles, we must rescale the overlaid predictions. We rescaled the predictions using the abundance rescaling method and an abundance of 1648 (Becker <em>et al.</em> 2016). Using the sum to 1 rescaling method would result in ensembles with similar distribution patterns, but the actual density values could not be used to provide a meaningful abundance estimate.</p>
<p><code>ensemble_rescale</code> requires a single <code>sf</code> object that contains all of the data being rescaled. Thus, we extract the prediction and variance values before using the rescaling function.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># Rescale predictions</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>over.sf &lt;-<span class="st"> </span><span class="kw">bind_cols</span>(</span>
<span id="cb17-3"><a href="#cb17-3"></a>  over1.sf <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">st_set_geometry</span>(<span class="ot">NULL</span>) <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="dt">pred_bm1 =</span> pred_bm, <span class="dt">var1 =</span> variance), </span>
<span id="cb17-4"><a href="#cb17-4"></a>  over2.sf <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">st_set_geometry</span>(<span class="ot">NULL</span>) <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="dt">pred_bm2 =</span> pred_bm, <span class="dt">var2 =</span> variance), </span>
<span id="cb17-5"><a href="#cb17-5"></a>  over3.sf <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">st_set_geometry</span>(<span class="ot">NULL</span>) <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="dt">pred_bm3 =</span> pred_bm, <span class="dt">var3 =</span> variance)</span>
<span id="cb17-6"><a href="#cb17-6"></a>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb17-7"><a href="#cb17-7"></a><span class="st">  </span><span class="kw">st_sf</span>(<span class="dt">geometry =</span> base.geom, <span class="dt">agr =</span> <span class="st">"constant"</span>)</span>
<span id="cb17-8"><a href="#cb17-8"></a></span>
<span id="cb17-9"><a href="#cb17-9"></a>over.sf.rescaled &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ensemble_rescale.html">ensemble_rescale</a></span>(</span>
<span id="cb17-10"><a href="#cb17-10"></a>  over.sf, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"pred_bm1"</span>, <span class="st">"pred_bm2"</span>, <span class="st">"pred_bm3"</span>), <span class="st">"abundance"</span>, <span class="dv">1648</span>, </span>
<span id="cb17-11"><a href="#cb17-11"></a>  <span class="dt">x.var.idx =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"var1"</span>, <span class="st">"var2"</span>, <span class="st">"var3"</span>)</span>
<span id="cb17-12"><a href="#cb17-12"></a>)</span>
<span id="cb17-13"><a href="#cb17-13"></a></span>
<span id="cb17-14"><a href="#cb17-14"></a><span class="co"># Check that overlaid predictions predict expected abundance</span></span>
<span id="cb17-15"><a href="#cb17-15"></a>eSDM<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/eSDM/man/model_abundance.html">model_abundance</a></span>(over.sf.rescaled, <span class="st">"pred_bm1"</span>)</span>
<span id="cb17-16"><a href="#cb17-16"></a><span class="co">#&gt; pred_bm1 </span></span>
<span id="cb17-17"><a href="#cb17-17"></a><span class="co">#&gt;     1648</span></span>
<span id="cb17-18"><a href="#cb17-18"></a>eSDM<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/eSDM/man/model_abundance.html">model_abundance</a></span>(over.sf.rescaled, <span class="st">"pred_bm2"</span>)</span>
<span id="cb17-19"><a href="#cb17-19"></a><span class="co">#&gt; pred_bm2 </span></span>
<span id="cb17-20"><a href="#cb17-20"></a><span class="co">#&gt;     1648</span></span>
<span id="cb17-21"><a href="#cb17-21"></a>eSDM<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/eSDM/man/model_abundance.html">model_abundance</a></span>(over.sf.rescaled, <span class="st">"pred_bm3"</span>)</span>
<span id="cb17-22"><a href="#cb17-22"></a><span class="co">#&gt; pred_bm3 </span></span>
<span id="cb17-23"><a href="#cb17-23"></a><span class="co">#&gt;     1648</span></span>
<span id="cb17-24"><a href="#cb17-24"></a></span>
<span id="cb17-25"><a href="#cb17-25"></a><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(over.sf.rescaled)</span>
<span id="cb17-26"><a href="#cb17-26"></a><span class="co">#&gt;     pred_bm1            var1          pred_bm2            var2   </span></span>
<span id="cb17-27"><a href="#cb17-27"></a><span class="co">#&gt;  Min.   :0.00001   Min.   :0e+00   Min.   :0.00003   Min.   :0   </span></span>
<span id="cb17-28"><a href="#cb17-28"></a><span class="co">#&gt;  1st Qu.:0.00029   1st Qu.:0e+00   1st Qu.:0.00063   1st Qu.:0   </span></span>
<span id="cb17-29"><a href="#cb17-29"></a><span class="co">#&gt;  Median :0.00080   Median :0e+00   Median :0.00104   Median :0   </span></span>
<span id="cb17-30"><a href="#cb17-30"></a><span class="co">#&gt;  Mean   :0.00148   Mean   :0e+00   Mean   :0.00147   Mean   :0   </span></span>
<span id="cb17-31"><a href="#cb17-31"></a><span class="co">#&gt;  3rd Qu.:0.00180   3rd Qu.:0e+00   3rd Qu.:0.00187   3rd Qu.:0   </span></span>
<span id="cb17-32"><a href="#cb17-32"></a><span class="co">#&gt;  Max.   :0.01970   Max.   :7e-05   Max.   :0.00645   Max.   :0   </span></span>
<span id="cb17-33"><a href="#cb17-33"></a><span class="co">#&gt;  NA's   :38        NA's   :38      NA's   :95        NA's   :95  </span></span>
<span id="cb17-34"><a href="#cb17-34"></a><span class="co">#&gt;     pred_bm3            var3                  geometry    </span></span>
<span id="cb17-35"><a href="#cb17-35"></a><span class="co">#&gt;  Min.   :0.00000   Min.   :0.00000   MULTIPOLYGON :11419  </span></span>
<span id="cb17-36"><a href="#cb17-36"></a><span class="co">#&gt;  1st Qu.:0.00020   1st Qu.:0.00000   epsg:NA      :    0  </span></span>
<span id="cb17-37"><a href="#cb17-37"></a><span class="co">#&gt;  Median :0.00051   Median :0.00000   +proj=cea ...:    0  </span></span>
<span id="cb17-38"><a href="#cb17-38"></a><span class="co">#&gt;  Mean   :0.00147   Mean   :0.00000                        </span></span>
<span id="cb17-39"><a href="#cb17-39"></a><span class="co">#&gt;  3rd Qu.:0.00225   3rd Qu.:0.00000                        </span></span>
<span id="cb17-40"><a href="#cb17-40"></a><span class="co">#&gt;  Max.   :0.01866   Max.   :0.00013                        </span></span>
<span id="cb17-41"><a href="#cb17-41"></a><span class="co">#&gt;  NA's   :41        NA's   :41</span></span></code></pre></div>
<p>We can see that the prediction values are now much more comparable, and thus a subset of the predictions will not contribute disproportionately to an ensemble.</p>
<p>We also must calculate the ensemble weights, which must be manually created. For the example analysis, we use several weighting methods: equal weights (i.e., unweighted), AUC-based weights, TSS-based weights, and weights calculated as the inverse of the prediction variance. Each set of weights must sum to 1, or each row must sum to 1 in the case of the weights calculated as the inverse of the prediction variance. Note that when calculating evaluation metrics, a message is printed if any of the validation data points do not intersect with a prediction polygon.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="co"># Calculate ensemble weights</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>e.weights &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</span>
<span id="cb18-3"><a href="#cb18-3"></a>  eSDM<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/eSDM/man/evaluation_metrics.html">evaluation_metrics</a></span>(over1.sf, <span class="dv">1</span>, valid.data, <span class="st">"pres_abs"</span>), </span>
<span id="cb18-4"><a href="#cb18-4"></a>  eSDM<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/eSDM/man/evaluation_metrics.html">evaluation_metrics</a></span>(over2.sf, <span class="dv">1</span>, valid.data, <span class="st">"pres_abs"</span>), </span>
<span id="cb18-5"><a href="#cb18-5"></a>  eSDM<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/eSDM/man/evaluation_metrics.html">evaluation_metrics</a></span>(over3.sf, <span class="dv">1</span>, valid.data, <span class="st">"pres_abs"</span>)</span>
<span id="cb18-6"><a href="#cb18-6"></a>)</span>
<span id="cb18-7"><a href="#cb18-7"></a><span class="co">#&gt; There were 83 validation points that did not overlap with a non-NA prediction polygon</span></span>
<span id="cb18-8"><a href="#cb18-8"></a><span class="co">#&gt; There were 171 validation points that did not overlap with a non-NA prediction polygon</span></span>
<span id="cb18-9"><a href="#cb18-9"></a><span class="co">#&gt; There were 84 validation points that did not overlap with a non-NA prediction polygon</span></span>
<span id="cb18-10"><a href="#cb18-10"></a></span>
<span id="cb18-11"><a href="#cb18-11"></a>over.df.resc.var &lt;-<span class="st"> </span>over.sf.rescaled <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb18-12"><a href="#cb18-12"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(var1, var2, var3) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb18-13"><a href="#cb18-13"></a><span class="st">  </span><span class="kw">st_set_geometry</span>(<span class="ot">NULL</span>)</span>
<span id="cb18-14"><a href="#cb18-14"></a></span>
<span id="cb18-15"><a href="#cb18-15"></a>e.weights.unw &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>) <span class="op">/</span><span class="st"> </span><span class="dv">3</span></span>
<span id="cb18-16"><a href="#cb18-16"></a>e.weights.auc &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(e.weights, <span class="cf">function</span>(i) i[<span class="dv">1</span>]) <span class="op">/</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(e.weights, <span class="cf">function</span>(i) i[<span class="dv">1</span>]))</span>
<span id="cb18-17"><a href="#cb18-17"></a>e.weights.tss &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(e.weights, <span class="cf">function</span>(i) i[<span class="dv">2</span>]) <span class="op">/</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(e.weights, <span class="cf">function</span>(i) i[<span class="dv">2</span>]))</span>
<span id="cb18-18"><a href="#cb18-18"></a>e.weights.var &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(</span>
<span id="cb18-19"><a href="#cb18-19"></a>  <span class="dv">1</span> <span class="op">/</span><span class="st"> </span>over.df.resc.var, <span class="dv">1</span>, <span class="cf">function</span>(i) {i <span class="op">/</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(i, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)}</span>
<span id="cb18-20"><a href="#cb18-20"></a>)))</span>
<span id="cb18-21"><a href="#cb18-21"></a></span>
<span id="cb18-22"><a href="#cb18-22"></a>e.weights.unw</span>
<span id="cb18-23"><a href="#cb18-23"></a><span class="co">#&gt; [1] 0.3333333 0.3333333 0.3333333</span></span>
<span id="cb18-24"><a href="#cb18-24"></a>e.weights.auc</span>
<span id="cb18-25"><a href="#cb18-25"></a><span class="co">#&gt; [1] 0.3564575 0.2859788 0.3575637</span></span>
<span id="cb18-26"><a href="#cb18-26"></a>e.weights.tss</span>
<span id="cb18-27"><a href="#cb18-27"></a><span class="co">#&gt; [1] 0.3897645 0.2127986 0.3974369</span></span>
<span id="cb18-28"><a href="#cb18-28"></a><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(e.weights.var)</span>
<span id="cb18-29"><a href="#cb18-29"></a><span class="co">#&gt;         var1      var2        var3</span></span>
<span id="cb18-30"><a href="#cb18-30"></a><span class="co">#&gt; 1 0.30739591 0.6897710 0.002833083</span></span>
<span id="cb18-31"><a href="#cb18-31"></a><span class="co">#&gt; 2 0.99305706        NA 0.006942942</span></span>
<span id="cb18-32"><a href="#cb18-32"></a><span class="co">#&gt; 3 0.99479068        NA 0.005209324</span></span>
<span id="cb18-33"><a href="#cb18-33"></a><span class="co">#&gt; 4 0.06759370 0.3232166 0.609189722</span></span>
<span id="cb18-34"><a href="#cb18-34"></a><span class="co">#&gt; 5 0.05685041 0.8348384 0.108311140</span></span>
<span id="cb18-35"><a href="#cb18-35"></a><span class="co">#&gt; 6 0.04114136 0.4182598 0.540598860</span></span></code></pre></div>
<p>Finally, we can create the ensembles. We calculate the ensemble uncertainty values with the among-model variance.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="co">### Create ensembles</span></span>
<span id="cb19-2"><a href="#cb19-2"></a></span>
<span id="cb19-3"><a href="#cb19-3"></a><span class="co"># Unweighted; calculate CV because it is used in Fig. 4 plot</span></span>
<span id="cb19-4"><a href="#cb19-4"></a>ens.sf.unw &lt;-<span class="st"> </span>eSDM<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/eSDM/man/ensemble_create.html">ensemble_create</a></span>(</span>
<span id="cb19-5"><a href="#cb19-5"></a>  over.sf.rescaled, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"pred_bm1"</span>, <span class="st">"pred_bm2"</span>, <span class="st">"pred_bm3"</span>),  <span class="dt">w =</span> e.weights.unw, </span>
<span id="cb19-6"><a href="#cb19-6"></a>  <span class="dt">x.var.idx =</span> <span class="ot">NULL</span></span>
<span id="cb19-7"><a href="#cb19-7"></a>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-8"><a href="#cb19-8"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">SE =</span> <span class="kw"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(Var_ens), <span class="dt">CV =</span> SE <span class="op">/</span><span class="st"> </span>Pred_ens) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-9"><a href="#cb19-9"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(Pred_ens, SE, CV) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-10"><a href="#cb19-10"></a><span class="st">  </span><span class="kw">st_set_agr</span>(<span class="st">"constant"</span>)</span>
<span id="cb19-11"><a href="#cb19-11"></a></span>
<span id="cb19-12"><a href="#cb19-12"></a><span class="co"># Weights based on AUC</span></span>
<span id="cb19-13"><a href="#cb19-13"></a>ens.sf.wauc &lt;-<span class="st"> </span>eSDM<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/eSDM/man/ensemble_create.html">ensemble_create</a></span>(</span>
<span id="cb19-14"><a href="#cb19-14"></a>  over.sf.rescaled, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"pred_bm1"</span>, <span class="st">"pred_bm2"</span>, <span class="st">"pred_bm3"</span>),  <span class="dt">w =</span> e.weights.auc, </span>
<span id="cb19-15"><a href="#cb19-15"></a>  <span class="dt">x.var.idx =</span> <span class="ot">NULL</span></span>
<span id="cb19-16"><a href="#cb19-16"></a>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-17"><a href="#cb19-17"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">SE =</span> <span class="kw"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(Var_ens)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-18"><a href="#cb19-18"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(Pred_ens, SE) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-19"><a href="#cb19-19"></a><span class="st">  </span><span class="kw">st_set_agr</span>(<span class="st">"constant"</span>)</span>
<span id="cb19-20"><a href="#cb19-20"></a></span>
<span id="cb19-21"><a href="#cb19-21"></a><span class="co"># Weights based on TSS</span></span>
<span id="cb19-22"><a href="#cb19-22"></a>ens.sf.wtss &lt;-<span class="st"> </span>eSDM<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/eSDM/man/ensemble_create.html">ensemble_create</a></span>(</span>
<span id="cb19-23"><a href="#cb19-23"></a>  over.sf.rescaled, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"pred_bm1"</span>, <span class="st">"pred_bm2"</span>, <span class="st">"pred_bm3"</span>),  <span class="dt">w =</span> e.weights.tss, </span>
<span id="cb19-24"><a href="#cb19-24"></a>  <span class="dt">x.var.idx =</span> <span class="ot">NULL</span></span>
<span id="cb19-25"><a href="#cb19-25"></a>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-26"><a href="#cb19-26"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">SE =</span> <span class="kw"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(Var_ens)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-27"><a href="#cb19-27"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(Pred_ens, SE) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-28"><a href="#cb19-28"></a><span class="st">  </span><span class="kw">st_set_agr</span>(<span class="st">"constant"</span>)</span>
<span id="cb19-29"><a href="#cb19-29"></a></span>
<span id="cb19-30"><a href="#cb19-30"></a><span class="co"># Weights based on the inverse of the variance</span></span>
<span id="cb19-31"><a href="#cb19-31"></a>ens.sf.wvar &lt;-<span class="st"> </span>eSDM<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/eSDM/man/ensemble_create.html">ensemble_create</a></span>(</span>
<span id="cb19-32"><a href="#cb19-32"></a>  over.sf.rescaled, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"pred_bm1"</span>, <span class="st">"pred_bm2"</span>, <span class="st">"pred_bm3"</span>),  <span class="dt">w =</span> e.weights.var, </span>
<span id="cb19-33"><a href="#cb19-33"></a>  <span class="dt">x.var.idx =</span> <span class="ot">NULL</span></span>
<span id="cb19-34"><a href="#cb19-34"></a>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-35"><a href="#cb19-35"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">SE =</span> <span class="kw"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(Var_ens)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-36"><a href="#cb19-36"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(Pred_ens, SE) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-37"><a href="#cb19-37"></a><span class="st">  </span><span class="kw">st_set_agr</span>(<span class="st">"constant"</span>)</span></code></pre></div>
<p>We could also have estimated the within-model ensemble uncertainty by using the <code>x.var.idx</code> argument, as demonstrated in the following code (not run).</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="co"># Create an ensemble and calculate within-model uncertainty; code not run</span></span>
<span id="cb20-2"><a href="#cb20-2"></a>ens.sf.unw.wmv &lt;-<span class="st"> </span>eSDM<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/eSDM/man/ensemble_create.html">ensemble_create</a></span>(</span>
<span id="cb20-3"><a href="#cb20-3"></a>  over.sf.rescaled, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"pred_bm1"</span>, <span class="st">"pred_bm2"</span>, <span class="st">"pred_bm3"</span>),  <span class="dt">w =</span> e.weights.unw,</span>
<span id="cb20-4"><a href="#cb20-4"></a>  <span class="dt">x.var.idx =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(var1, var2, var3)</span>
<span id="cb20-5"><a href="#cb20-5"></a>) <span class="op">%&gt;%</span></span>
<span id="cb20-6"><a href="#cb20-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">SE =</span> <span class="kw"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(Var_ens)) <span class="op">%&gt;%</span></span>
<span id="cb20-7"><a href="#cb20-7"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(Pred_ens , SE)</span></code></pre></div>
<p>Now we can calculate AUC and TSS scores for the ensembles and compare them to those of original and ensemble predictions. Again, the evaluation code is not run; the displayed table is Table 3 from Woodman <em>et al.</em> (2019).</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="co"># Calculate evaluation metrics for ensembles; code not run</span></span>
<span id="cb21-2"><a href="#cb21-2"></a>names<span class="fl">.2</span> &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(</span>
<span id="cb21-3"><a href="#cb21-3"></a>  <span class="st">"Ensemble – unweighted"</span>, <span class="st">"Ensemble – AUC-based weights"</span>,</span>
<span id="cb21-4"><a href="#cb21-4"></a>  <span class="st">"Ensemble – TSS-based weights"</span>, <span class="st">"Ensemble – variance-based weights"</span></span>
<span id="cb21-5"><a href="#cb21-5"></a>)</span>
<span id="cb21-6"><a href="#cb21-6"></a></span>
<span id="cb21-7"><a href="#cb21-7"></a>eval.lt.ens &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span>(rbind, <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</span>
<span id="cb21-8"><a href="#cb21-8"></a>  eSDM<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/eSDM/man/evaluation_metrics.html">evaluation_metrics</a></span>(ens.sf.unw,  <span class="st">"Pred_ens"</span>, valid.data.lt, <span class="st">"pres_abs"</span>), </span>
<span id="cb21-9"><a href="#cb21-9"></a>  eSDM<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/eSDM/man/evaluation_metrics.html">evaluation_metrics</a></span>(ens.sf.wauc, <span class="st">"Pred_ens"</span>, valid.data.lt, <span class="st">"pres_abs"</span>), </span>
<span id="cb21-10"><a href="#cb21-10"></a>  eSDM<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/eSDM/man/evaluation_metrics.html">evaluation_metrics</a></span>(ens.sf.wtss, <span class="st">"Pred_ens"</span>, valid.data.lt, <span class="st">"pres_abs"</span>), </span>
<span id="cb21-11"><a href="#cb21-11"></a>  eSDM<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/eSDM/man/evaluation_metrics.html">evaluation_metrics</a></span>(ens.sf.wvar, <span class="st">"Pred_ens"</span>, valid.data.lt, <span class="st">"pres_abs"</span>)</span>
<span id="cb21-12"><a href="#cb21-12"></a>))) <span class="op">%&gt;%</span></span>
<span id="cb21-13"><a href="#cb21-13"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Preds =</span> names<span class="fl">.2</span>) <span class="op">%&gt;%</span></span>
<span id="cb21-14"><a href="#cb21-14"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(Preds, <span class="dt">AUC_LT =</span> X1, <span class="dt">TSS_LT =</span> X2)</span>
<span id="cb21-15"><a href="#cb21-15"></a></span>
<span id="cb21-16"><a href="#cb21-16"></a>eval.hr.ens &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span>(rbind, <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</span>
<span id="cb21-17"><a href="#cb21-17"></a>  eSDM<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/eSDM/man/evaluation_metrics.html">evaluation_metrics</a></span>(ens.sf.unw,  <span class="st">"Pred_ens"</span>, valid.data.hr, <span class="st">"pres_abs"</span>), </span>
<span id="cb21-18"><a href="#cb21-18"></a>  eSDM<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/eSDM/man/evaluation_metrics.html">evaluation_metrics</a></span>(ens.sf.wauc, <span class="st">"Pred_ens"</span>, valid.data.hr, <span class="st">"pres_abs"</span>), </span>
<span id="cb21-19"><a href="#cb21-19"></a>  eSDM<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/eSDM/man/evaluation_metrics.html">evaluation_metrics</a></span>(ens.sf.wtss, <span class="st">"Pred_ens"</span>, valid.data.hr, <span class="st">"pres_abs"</span>), </span>
<span id="cb21-20"><a href="#cb21-20"></a>  eSDM<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/eSDM/man/evaluation_metrics.html">evaluation_metrics</a></span>(ens.sf.wvar, <span class="st">"Pred_ens"</span>, valid.data.hr, <span class="st">"pres_abs"</span>)</span>
<span id="cb21-21"><a href="#cb21-21"></a>))) <span class="op">%&gt;%</span></span>
<span id="cb21-22"><a href="#cb21-22"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Preds =</span> names<span class="fl">.2</span>) <span class="op">%&gt;%</span></span>
<span id="cb21-23"><a href="#cb21-23"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(Preds, <span class="dt">AUC_HR =</span> X1, <span class="dt">TSS_HR =</span> X2) </span>
<span id="cb21-24"><a href="#cb21-24"></a></span>
<span id="cb21-25"><a href="#cb21-25"></a>eval.combo.ens &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span>(rbind, <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</span>
<span id="cb21-26"><a href="#cb21-26"></a>  eSDM<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/eSDM/man/evaluation_metrics.html">evaluation_metrics</a></span>(ens.sf.unw,  <span class="st">"Pred_ens"</span>, valid.data, <span class="st">"pres_abs"</span>), </span>
<span id="cb21-27"><a href="#cb21-27"></a>  eSDM<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/eSDM/man/evaluation_metrics.html">evaluation_metrics</a></span>(ens.sf.wauc, <span class="st">"Pred_ens"</span>, valid.data, <span class="st">"pres_abs"</span>), </span>
<span id="cb21-28"><a href="#cb21-28"></a>  eSDM<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/eSDM/man/evaluation_metrics.html">evaluation_metrics</a></span>(ens.sf.wtss, <span class="st">"Pred_ens"</span>, valid.data, <span class="st">"pres_abs"</span>), </span>
<span id="cb21-29"><a href="#cb21-29"></a>  eSDM<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/eSDM/man/evaluation_metrics.html">evaluation_metrics</a></span>(ens.sf.wvar, <span class="st">"Pred_ens"</span>, valid.data, <span class="st">"pres_abs"</span>)</span>
<span id="cb21-30"><a href="#cb21-30"></a>))) <span class="op">%&gt;%</span></span>
<span id="cb21-31"><a href="#cb21-31"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Preds =</span> names<span class="fl">.2</span>) <span class="op">%&gt;%</span></span>
<span id="cb21-32"><a href="#cb21-32"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(Preds, <span class="dt">AUC =</span> X1, <span class="dt">TSS =</span> X2)</span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="kw"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata/Table3.csv"</span>, <span class="dt">package =</span> <span class="st">"eSDM"</span>)) <span class="op">%&gt;%</span></span>
<span id="cb22-2"><a href="#cb22-2"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(Predictions, AUC, TSS, <span class="st">`</span><span class="dt">AUC-LT</span><span class="st">`</span> =<span class="st"> </span>AUC.LT, <span class="st">`</span><span class="dt">TSS-LT</span><span class="st">`</span> =<span class="st"> </span>TSS.LT, </span>
<span id="cb22-3"><a href="#cb22-3"></a>                <span class="st">`</span><span class="dt">AUC-HR</span><span class="st">`</span> =<span class="st"> </span>AUC.HR, <span class="st">`</span><span class="dt">TSS-HR</span><span class="st">`</span> =<span class="st"> </span>TSS.HR) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb22-4"><a href="#cb22-4"></a><span class="st">  </span>knitr<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span>(<span class="dt">caption =</span> <span class="st">"Evaluation metrics"</span>, <span class="dt">digits =</span> <span class="dv">3</span>, <span class="dt">align =</span> <span class="st">"lcccccc"</span>)</span></code></pre></div>
<table class="table">
<caption>Evaluation metrics</caption>
<thead><tr class="header">
<th align="left">Predictions</th>
<th align="center">AUC</th>
<th align="center">TSS</th>
<th align="center">AUC-LT</th>
<th align="center">TSS-LT</th>
<th align="center">AUC-HR</th>
<th align="center">TSS-HR</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Model_B - original</td>
<td align="center">0.912</td>
<td align="center">0.717</td>
<td align="center">0.732</td>
<td align="center">0.374</td>
<td align="center">0.963</td>
<td align="center">0.824</td>
</tr>
<tr class="even">
<td align="left">Model_H - original</td>
<td align="center">0.734</td>
<td align="center">0.414</td>
<td align="center">0.620</td>
<td align="center">0.284</td>
<td align="center">0.772</td>
<td align="center">0.471</td>
</tr>
<tr class="odd">
<td align="left">Model_R - original</td>
<td align="center">0.919</td>
<td align="center">0.756</td>
<td align="center">0.684</td>
<td align="center">0.290</td>
<td align="center">0.980</td>
<td align="center">0.882</td>
</tr>
<tr class="even">
<td align="left">Model_B - overlaid</td>
<td align="center">0.916</td>
<td align="center">0.742</td>
<td align="center">0.732</td>
<td align="center">0.380</td>
<td align="center">0.967</td>
<td align="center">0.856</td>
</tr>
<tr class="odd">
<td align="left">Model_H - overlaid</td>
<td align="center">0.735</td>
<td align="center">0.406</td>
<td align="center">0.620</td>
<td align="center">0.286</td>
<td align="center">0.772</td>
<td align="center">0.460</td>
</tr>
<tr class="even">
<td align="left">Model_R - overlaid</td>
<td align="center">0.919</td>
<td align="center">0.756</td>
<td align="center">0.684</td>
<td align="center">0.290</td>
<td align="center">0.980</td>
<td align="center">0.882</td>
</tr>
<tr class="odd">
<td align="left">Ensemble - unweighted</td>
<td align="center">0.915</td>
<td align="center">0.772</td>
<td align="center">0.699</td>
<td align="center">0.345</td>
<td align="center">0.972</td>
<td align="center">0.888</td>
</tr>
<tr class="even">
<td align="left">Ensemble - AUC-based weights</td>
<td align="center">0.917</td>
<td align="center">0.777</td>
<td align="center">0.703</td>
<td align="center">0.349</td>
<td align="center">0.973</td>
<td align="center">0.893</td>
</tr>
<tr class="odd">
<td align="left">Ensemble - TSS-based weights</td>
<td align="center">0.920</td>
<td align="center">0.785</td>
<td align="center">0.708</td>
<td align="center">0.352</td>
<td align="center">0.975</td>
<td align="center">0.900</td>
</tr>
<tr class="even">
<td align="left">Ensemble - variance-based weights</td>
<td align="center">0.888</td>
<td align="center">0.670</td>
<td align="center">0.713</td>
<td align="center">0.344</td>
<td align="center">0.936</td>
<td align="center">0.764</td>
</tr>
</tbody>
</table>
<p>We can see that the ensemble with weights based on TSS values had the highest scores of the ensemble predictions, and mostly higher scores that the original predictions. We can visualize this ensemble to compare it with known blue whale habitat.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="co"># Simple code to visualize ensemble created with weights based on TSS values</span></span>
<span id="cb23-2"><a href="#cb23-2"></a><span class="kw">plot_sf_3panel</span>(</span>
<span id="cb23-3"><a href="#cb23-3"></a>  <span class="kw">rename</span>(ens.sf.wtss, <span class="dt">se =</span> SE), <span class="st">"Pred_ens"</span>, <span class="dt">main.txt =</span> <span class="st">"Ensemble-TSS - "</span>, </span>
<span id="cb23-4"><a href="#cb23-4"></a>  <span class="dt">map.base =</span> map.world, <span class="dt">x.axis.at =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="dv">130</span>, <span class="dv">-125</span>, <span class="dv">-120</span>)</span>
<span id="cb23-5"><a href="#cb23-5"></a>)</span></code></pre></div>
<p><img src="example-analysis_files/figure-html/unnamed-chunk-23-1.png" width="672"></p>
<p>Below is code to visualize the unweighted ensembles and this ensemble (i.e., create plots similar to Figs. 4 and 5 in Woodman <em>et al.</em>). This code uses custom functions (located at <code><a href="https://rdrr.io/r/base/system.file.html">system.file("eSDM_vignette_helper.R", package = "eSDM")</a></code>) that leverage the <code>tmap</code> package to generate plots. However, by default this code is not run because each plot takes several minutes to generate.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="co">### Figure 4; code not run</span></span>
<span id="cb24-2"><a href="#cb24-2"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(tmap)</span>
<span id="cb24-3"><a href="#cb24-3"></a></span>
<span id="cb24-4"><a href="#cb24-4"></a><span class="co"># Values passed to tmap_sdm - range of map</span></span>
<span id="cb24-5"><a href="#cb24-5"></a>range.poly &lt;-<span class="st"> </span><span class="kw">st_sfc</span>(</span>
<span id="cb24-6"><a href="#cb24-6"></a>  <span class="kw">st_polygon</span>(<span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(</span>
<span id="cb24-7"><a href="#cb24-7"></a>    <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="dv">132</span>, <span class="dv">-132</span>, <span class="dv">-116</span>, <span class="dv">-116</span>, <span class="dv">-132</span>, <span class="fl">29.5</span>, <span class="dv">49</span>, <span class="dv">49</span>, <span class="fl">29.5</span>, <span class="fl">29.5</span>), <span class="dt">ncol =</span> <span class="dv">2</span></span>
<span id="cb24-8"><a href="#cb24-8"></a>  ))),</span>
<span id="cb24-9"><a href="#cb24-9"></a>  <span class="dt">crs =</span> <span class="dv">4326</span></span>
<span id="cb24-10"><a href="#cb24-10"></a>)</span>
<span id="cb24-11"><a href="#cb24-11"></a>rpoly.mat &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="kw">st_bbox</span>(range.poly), <span class="dt">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb24-12"><a href="#cb24-12"></a></span>
<span id="cb24-13"><a href="#cb24-13"></a><span class="co"># Values passed to tmap_sdm - size of text labels and legend width</span></span>
<span id="cb24-14"><a href="#cb24-14"></a>main.size &lt;-<span class="st"> </span><span class="fl">0.8</span></span>
<span id="cb24-15"><a href="#cb24-15"></a>leg.size  &lt;-<span class="st"> </span><span class="fl">0.55</span></span>
<span id="cb24-16"><a href="#cb24-16"></a>leg.width &lt;-<span class="st"> </span><span class="fl">0.43</span></span>
<span id="cb24-17"><a href="#cb24-17"></a>grid.size &lt;-<span class="st"> </span><span class="fl">0.55</span></span>
<span id="cb24-18"><a href="#cb24-18"></a></span>
<span id="cb24-19"><a href="#cb24-19"></a><span class="co"># Values passed to tmap_sdm - color scale info</span></span>
<span id="cb24-20"><a href="#cb24-20"></a>blp1 &lt;-<span class="st"> </span><span class="kw">tmap_sdm_help</span>(ens.sf.unw, <span class="st">"Pred_ens"</span>)</span>
<span id="cb24-21"><a href="#cb24-21"></a>blp2 &lt;-<span class="st"> </span><span class="kw">tmap_sdm_help</span>(ens.sf.unw, <span class="st">"CV"</span>)</span>
<span id="cb24-22"><a href="#cb24-22"></a></span>
<span id="cb24-23"><a href="#cb24-23"></a><span class="co"># Plot of predictions (whales / km^-2)</span></span>
<span id="cb24-24"><a href="#cb24-24"></a>tmap.obj1 &lt;-<span class="st"> </span><span class="kw">tmap_sdm</span>(</span>
<span id="cb24-25"><a href="#cb24-25"></a>  ens.sf.unw, <span class="st">"Pred_ens"</span>, blp1, map.world, rpoly.mat, </span>
<span id="cb24-26"><a href="#cb24-26"></a>  <span class="st">"Unweighted ensemble - predictions"</span>, </span>
<span id="cb24-27"><a href="#cb24-27"></a>  main.size, leg.size, leg.width, grid.size</span>
<span id="cb24-28"><a href="#cb24-28"></a>)</span>
<span id="cb24-29"><a href="#cb24-29"></a><span class="co"># Plot of SE values (with same color sceme as predictions)</span></span>
<span id="cb24-30"><a href="#cb24-30"></a>tmap.obj2 &lt;-<span class="st"> </span><span class="kw">tmap_sdm</span>(</span>
<span id="cb24-31"><a href="#cb24-31"></a>  ens.sf.unw, <span class="st">"SE"</span>, blp1, map.world, rpoly.mat, </span>
<span id="cb24-32"><a href="#cb24-32"></a>  <span class="st">"Unweighted ensemble - SE"</span>, </span>
<span id="cb24-33"><a href="#cb24-33"></a>  main.size, leg.size, leg.width, grid.size</span>
<span id="cb24-34"><a href="#cb24-34"></a>)</span>
<span id="cb24-35"><a href="#cb24-35"></a><span class="co"># Plot of CV values</span></span>
<span id="cb24-36"><a href="#cb24-36"></a>tmap.obj3 &lt;-<span class="st"> </span><span class="kw">tmap_sdm</span>(</span>
<span id="cb24-37"><a href="#cb24-37"></a>  ens.sf.unw, <span class="st">"CV"</span>, blp2, map.world, rpoly.mat, </span>
<span id="cb24-38"><a href="#cb24-38"></a>  <span class="st">"Unweighted ensemble - CV"</span>, </span>
<span id="cb24-39"><a href="#cb24-39"></a>  main.size, leg.size, leg.width, grid.size</span>
<span id="cb24-40"><a href="#cb24-40"></a>)</span>
<span id="cb24-41"><a href="#cb24-41"></a></span>
<span id="cb24-42"><a href="#cb24-42"></a><span class="co"># Generate plot</span></span>
<span id="cb24-43"><a href="#cb24-43"></a><span class="kw">tmap_arrange</span>(</span>
<span id="cb24-44"><a href="#cb24-44"></a>  <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(tmap.obj1, tmap.obj2, tmap.obj3), <span class="dt">ncol =</span> <span class="dv">3</span>, <span class="dt">asp =</span> <span class="ot">NULL</span>, <span class="dt">outer.margins =</span> <span class="fl">0.05</span></span>
<span id="cb24-45"><a href="#cb24-45"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="co">### Figure 5; code not run</span></span>
<span id="cb25-2"><a href="#cb25-2"></a></span>
<span id="cb25-3"><a href="#cb25-3"></a><span class="co"># Values passed to tmap_sdm - size of text labels and legend width</span></span>
<span id="cb25-4"><a href="#cb25-4"></a>main.size &lt;-<span class="st"> </span><span class="fl">1.1</span></span>
<span id="cb25-5"><a href="#cb25-5"></a>leg.size  &lt;-<span class="st"> </span><span class="fl">0.7</span></span>
<span id="cb25-6"><a href="#cb25-6"></a>leg.width &lt;-<span class="st"> </span><span class="fl">0.6</span></span>
<span id="cb25-7"><a href="#cb25-7"></a>grid.size &lt;-<span class="st"> </span><span class="fl">0.7</span></span>
<span id="cb25-8"><a href="#cb25-8"></a></span>
<span id="cb25-9"><a href="#cb25-9"></a><span class="co"># Values passed to tmap_sdm - color scale info</span></span>
<span id="cb25-10"><a href="#cb25-10"></a>blp1b &lt;-<span class="st"> </span><span class="kw">tmap_sdm_help</span>(ens.sf.wtss, <span class="st">"Pred_ens"</span>)</span>
<span id="cb25-11"><a href="#cb25-11"></a>blp2b &lt;-<span class="st"> </span><span class="kw">tmap_sdm_help_perc</span>(ens.sf.wtss, <span class="st">"Pred_ens"</span>)</span>
<span id="cb25-12"><a href="#cb25-12"></a></span>
<span id="cb25-13"><a href="#cb25-13"></a><span class="co"># Plot of predictions (whales / km^-2)</span></span>
<span id="cb25-14"><a href="#cb25-14"></a>tmap.obj1 &lt;-<span class="st"> </span><span class="kw">tmap_sdm</span>(</span>
<span id="cb25-15"><a href="#cb25-15"></a>  ens.sf.wtss, <span class="st">"Pred_ens"</span>, blp1, map.world, rpoly.mat, <span class="st">"Ensemble-TSS - Predictions"</span>, </span>
<span id="cb25-16"><a href="#cb25-16"></a>  main.size, leg.size, leg.width, grid.size</span>
<span id="cb25-17"><a href="#cb25-17"></a>)</span>
<span id="cb25-18"><a href="#cb25-18"></a><span class="co"># Plot of SE values (with same color sceme as predictions)</span></span>
<span id="cb25-19"><a href="#cb25-19"></a>tmap.obj2 &lt;-<span class="st"> </span><span class="kw">tmap_sdm</span>(</span>
<span id="cb25-20"><a href="#cb25-20"></a>  ens.sf.wtss, <span class="st">"SE"</span>, blp1, map.world, rpoly.mat, <span class="st">"Ensemble-TSS - SE"</span>, </span>
<span id="cb25-21"><a href="#cb25-21"></a>  main.size, leg.size, leg.width, grid.size</span>
<span id="cb25-22"><a href="#cb25-22"></a>)</span>
<span id="cb25-23"><a href="#cb25-23"></a><span class="co"># Plot of predictions (percentiles)</span></span>
<span id="cb25-24"><a href="#cb25-24"></a>tmap.obj3 &lt;-<span class="st"> </span><span class="kw">tmap_sdm</span>(</span>
<span id="cb25-25"><a href="#cb25-25"></a>  ens.sf.wtss, <span class="st">"Pred_ens"</span>, blp2b, map.world, rpoly.mat, <span class="st">"Ensemble-TSS - Predictions"</span>, </span>
<span id="cb25-26"><a href="#cb25-26"></a>  main.size, leg.size, leg.width, grid.size</span>
<span id="cb25-27"><a href="#cb25-27"></a>)</span>
<span id="cb25-28"><a href="#cb25-28"></a><span class="co"># Plot of predictions (percentiles) with combined validation data presence points</span></span>
<span id="cb25-29"><a href="#cb25-29"></a>tmap.obj4 &lt;-<span class="st"> </span><span class="kw">tmap_sdm</span>(</span>
<span id="cb25-30"><a href="#cb25-30"></a>  ens.sf.wtss, <span class="st">"Pred_ens"</span>, blp2b, map.world, rpoly.mat, <span class="st">"Ensemble-TSS - Predictions"</span>, </span>
<span id="cb25-31"><a href="#cb25-31"></a>  main.size, leg.size, leg.width, grid.size</span>
<span id="cb25-32"><a href="#cb25-32"></a>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb25-33"><a href="#cb25-33"></a><span class="st">  </span><span class="kw">tm_shape</span>(<span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(valid.data, pres_abs <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb25-34"><a href="#cb25-34"></a><span class="st">  </span><span class="kw">tm_dots</span>(<span class="dt">col =</span> <span class="st">"black"</span>, <span class="dt">size =</span> <span class="fl">0.04</span>, <span class="dt">shape =</span> <span class="dv">19</span>)</span>
<span id="cb25-35"><a href="#cb25-35"></a></span>
<span id="cb25-36"><a href="#cb25-36"></a><span class="co"># Generate plot</span></span>
<span id="cb25-37"><a href="#cb25-37"></a><span class="kw">tmap_arrange</span>(</span>
<span id="cb25-38"><a href="#cb25-38"></a>  <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(tmap.obj1, tmap.obj2, tmap.obj3, tmap.obj4), <span class="dt">ncol =</span> <span class="dv">2</span>, <span class="dt">nrow =</span> <span class="dv">2</span>, </span>
<span id="cb25-39"><a href="#cb25-39"></a>  <span class="dt">asp =</span> <span class="ot">NULL</span>, <span class="dt">outer.margins =</span> <span class="fl">0.05</span></span>
<span id="cb25-40"><a href="#cb25-40"></a>)</span></code></pre></div>
</div>
<div id="references" class="section level2">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<p>Becker, E., Forney, K., Fiedler, P., Barlow, J., Chivers, S., Edwards, C., … Redfern, J. (2016). Moving towards dynamic ocean management: how well do modeled ocean products predict species distributions? Remote Sensing, 8, 149. <a href="https://doi.org/10.3390/rs8020149" class="uri">https://doi.org/10.3390/rs8020149</a></p>
<p>Hazen, E.L., Palacios, D.M., Forney, K.A., Howell, E.A., Becker, E., Hoover, A.L., … Bailey, H. (2017). WhaleWatch: a dynamic management tool for predicting blue whale density in the California Current. Journal of Applied Ecology, 54, 1415-1428. <a href="https://doi.org/10.1111/1365-2664.12820" class="uri">https://doi.org/10.1111/1365-2664.12820</a></p>
<p>Irvine, L.M., Mate, B.R., Winsor, M.H., Palacios, D.M., Bograd, S.J., Costa, D.P. &amp; Bailey, H. (2014). Spatial and temporal occurrence of blue whales off the U.S. West Coast, with implications for management. PLoS One, 9, e102959. <a href="https://doi.org/10.1371/journal.pone.0109485" class="uri">https://doi.org/10.1371/journal.pone.0109485</a></p>
<p>Redfern, J.V., Moore, T.J., Fiedler, P.C., de Vos, A., Brownell, R.L., Forney, K.A., … Heikkinen, R. (2017). Predicting cetacean distributions in data-poor marine ecosystems. Diversity and Distributions, 23, 394-408. <a href="https://doi.org/10.1111/ddi.12537" class="uri">https://doi.org/10.1111/ddi.12537</a></p>
<p>Woodman, S.M., Forney, K.A., Becker, E.A., DeAngelis, M.L., Hazen, E.L., Palacios, D.M., Redfern, J.V. (2019). eSDM: A tool for creating and exploring ensembles of predictions from species distribution and abundance models. Methods in Ecology and Evolution. 2019;10:1923-1933. <a href="https://doi.org/10.1111/2041-210X.13283" class="uri">https://doi.org/10.1111/2041-210X.13283</a></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#overview">Overview</a></li>
      <li><a href="#import-sdm-predictions">Import SDM predictions</a></li>
      <li><a href="#overlay-predictions">Overlay predictions</a></li>
      <li><a href="#calculate-evaluation-metrics">Calculate evaluation metrics</a></li>
      <li><a href="#create-and-evaluate-ensemble-predictions">Create and evaluate ensemble predictions</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Sam Woodman.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
